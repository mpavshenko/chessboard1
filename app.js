"use strict";function board(e,t){var o=new Chess;o.reset();var n=$(e),i=$(t),a=window.innerWidth,r=window.innerHeight-$("#header").height(),s="#9C6C49",c=Math.floor((Math.min(a,r)-40)/8.6),l=.3*c,d=8*c+4,p=d+2*l;n.width(p).height(p);for(var h="gameField",u=$('<div class="'+h+'"/>').height(d).width(d),w=[],g=0;g<o.SQUARES.length;g++){var v=o.SQUARES[g],f=o.square_color(v),b=o.get(v),m=$('<div id="'+v+'" class="cell"></div>').width(c).height(c);u.append(m.addClass(f)),b&&m.append($('<div data-type="'+b.type+'" data-color="'+b.color+'" class="piece"></div>').width(c).height(c).css("background-image","url(img/pieces/"+b.type+b.color+".svg)")),w.push(m[0])}var k=$("<div>").css("margin-left",l+"px"),P=["A","B","C","D","E","F","G","H"];for(g=0;g<8;g++){var y=$('<div class="alphabetLetter">'+P[g]+"</div>").width(c).height(l).css("line-height",l+"px").css("font-size",.2*c+"px");k.append(y)}var K=$('<div class="numericLetterPanel"/>').width(l);for(g=8;0<g;g--){var Q=$('<div class="numericLetter">'+g+"</div>").css("line-height",c+"px").css("font-size",.2*c+"px");K.append(Q)}n.append(k),n.append($("<div/>").append(K).append(u).append(K.clone())),n.append(k.clone());var x=["b","w"],C=["r","n","b","k","q","p"],q=$("<div/>"),A=[];for(g=0;g<x.length;g++){for(var S=$('<div class="pieces-panel-row"/>'),R=0;R<C.length;R++){m=B("url(img/pieces/"+C[R]+x[g]+".svg)",C[R],x[g]);S.append(m),A.push(m[0])}if(0==g){m=B("url(img/pieces/custom/candy.svg)");S.append(m),A.push(m[0]),m=B("url(img/pieces/custom/ice-cream.svg)"),S.append(m),A.push(m[0])}else{m=B("url(img/pieces/custom/bomb.svg)");S.append(m),A.push(m[0]),m=B("url(img/pieces/custom/crocodile.svg)"),S.append(m),A.push(m[0])}q.append(S)}q.append('<div class="clearfix"/>'),i.append(q).css("padding",l+"px");var T=null;function B(e){var t=$('<div class="cell"></div>').width(c).height(c);return t.append($('<div data-type="'+b.type+'" data-color="'+b.color+'" class="piece"/>').width(c).height(c).css("background-image",e)),t}function z(){T&&T.removeClass("clicked"),T=null}function E(){L=U=null,$("#arrow-btn").css("background-color",""),$("#arrow-btn").css("box-shadow","none"),$("#arrow-btn").css("color","white"),$("."+h+" .cell, ."+h+" .piece").removeClass("cursor-pointer")}var U=null,W="ARROW_DRAW_MODE",F=$cArrows("."+h),L=null;$(".cell").on("click",function(e){if(e.stopPropagation(),U==W)if(0<$(this).parents("."+h).length)if(L){var t=$(this).attr("id");L!=t&&(F.arrow("#"+L,"#"+$(this).attr("id"),{arrow:{connectionType:"center"},render:{strokeStyle:"white",lineWidth:c/7}}),F.arrow("#"+L,"#"+$(this).attr("id"),{arrow:{connectionType:"center"},render:{strokeStyle:"#43362D",lineWidth:c/8}})),L=null}else L=$(this).attr("id");else E();else{var n=$(this);T?(0==n.parents("#pieces-panel").length?(T.is(n)||n.empty(),0<T.parents("#pieces-panel").length?$(T.children()[0]).clone().prependTo(n):$(T.children()[0]).detach().prependTo(n)):0==T.parents("#pieces-panel").length&&T.empty(),0!=T.parents("#pieces-panel").length&&0!=n.parents(".gameField").length||z()):0<n.children().length&&(T=n).addClass("clicked")}}),$(window).on("click",function(e){T&&(0==T.parents("#pieces-panel").length&&T.empty(),z()),E()});var D=dragula(w.concat(A),{revertOnSpill:!0,removeOnSpill:!0,accepts:function(e,t,n,i){return!(0<$(t).parents("#pieces-panel").length)&&(setTimeout(function(){$(".gu-transit",t).prependTo(t)}),!0)},copy:function(e){return 0<$(e).parents("#pieces-panel").length}});function N(){for(var e=0;e<o.SQUARES.length;e++){var t=o.SQUARES[e],n=o.get(t);if(n)$("#"+t).append($('<div data-type="'+n.type+'" data-color="'+n.color+'" id="'+t+'" class="piece"></div>').width(c).height(c).css("background-image","url(img/pieces/"+n.type+n.color+".svg)"))}}function M(){$(".btn-main").height(c).width(c).css("font-size",c/2).css("line-height",c+"px")}function O(){var e=$("body").hasClass("hide-sidedrawer")?0:$("#sidedrawer").width();0<$(window).width()-e-$("#board-container").outerWidth(!0)-Math.min($("#pieces-panel").outerWidth(!0),$("#pieces-panel").outerHeight(!0))?($("#pieces-panel .cell").css("float","none"),$("#pieces-panel .pieces-panel-row").css("float","left")):($("#pieces-panel .cell").css("float","left"),$("#pieces-panel .pieces-panel-row").css("float","none"))}D.on("drag",function(e,t){E(),T&&z()}),D.on("drop",function(e,t,n,i){var a=$(t).attr("id"),r=$(n).attr("id");!function(e,t,n,i){o.remove(e),o.put({type:t,color:n},i)}(a,$(e).attr("data-type"),$(e).attr("data-color"),r),$(t).children().not(":first").remove()}),$(window).resize(function(){O(),M()}),$(document).ready(function(){O(),M()});var j={clear:function(){o.clear(),$(".piece",e).remove()},initial:function(){j.clear(),o.reset(),N()},getPosition:function(){alert(o.fen())},setPosition:function(e){j.clear(),o.reset(),o.load(e),N()},setPositionFromUser:function(){var e=prompt("Введите позиции в формате FEN","rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");e&&j.setPosition(e)}};return j.createArrow=function(e){z(),U=W,$("#arrow-btn").css("background-color","white"),$("#arrow-btn").css("box-shadow","inset 0 0 0 "+c/10+"px "+s),$("#arrow-btn").css("color",s),$("."+h+" .cell, ."+h+" .piece").addClass("cursor-pointer"),e.stopPropagation()},j.clearArrowLayout=function(){F.CanvasStorage[2]=[],F.redraw()},j.sizePx=p,j}var board=board("#board-container","#pieces-panel");$("#load-fen-btn-header").click(board.setPositionFromUser),$("#save-fen-btn-header").click(board.getPosition),$("#clear-btn, #clear-btn-header").click(board.clear),$("#initial-btn, #initial-btn-header").click(board.initial),$("#arrow-btn, #arrow-btn-header").click(board.createArrow),$("#arrows-delete-btn, #arrows-delete-btn-header").click(board.clearArrowLayout),$("#download-image-btn, #download-image-btn-header").click(function(e){html2canvas($("#board-container"),{onrendered:function(e){var t=e.getContext("2d");t.globalAlpha=.2,t.textAlign="center";var n=board.sizePx/8;t.font=n+"px Arial",t.shadowColor="black",t.shadowBlur=1,t.textBaseline="alphabetic",t.scale(1,1),t.fillStyle="white",t.fillText("chess-board.ru",e.width/2,e.height/2+n/4),document.body.appendChild(e);var i=document.createElement("a"),a=e.toDataURL("image/png");a=a.replace("image/png","image/octet-stream"),document.body.removeChild(e),i.download="board.png",i.href=a,i.click()},width:board.sizePx,height:board.sizePx})});var savedPositions={"1-1":"3k4/3p4/8/3KB3/8/p7/P7/5b2 w KQkq - 0 1","1-2":"8/6k1/6p1/3K4/5B2/8/8/8 w KQkq - 0 1","1-3":"2r5/8/2p1k3/2P5/8/5B2/5K2/8 w KQkq - 0 1","1-4":"7k/8/1p6/1P6/1Q1K4/8/8/8 w KQkq - 0 1","1-5":"2r4k/8/5p2/5P2/6K1/8/1Q5P/8 w KQkq - 0 1","1-6":"8/3b1k2/3p4/8/2N5/2P5/2K5/8 w KQkq - 0 1","1-7":"8/8/2pk4/8/2PP4/3K4/8/8 w KQkq - 0 1","2-1":"6k1/8/3R2K1/8/8/8/8/8 w KQkq - 0 1","2-2":"7k/8/6K1/8/8/8/5R2/8 w KQkq - 0 1","2-3":"8/8/8/5K2/7k/8/8/3Q4 w KQkq - 0 1","2-4":"8/6Q1/8/8/2K5/8/k7/2B5 w KQkq - 0 1","2-5":"1Q6/8/8/7N/2K5/7k/8/8 w KQkq - 0 1","2-6":"7k/2p2R2/3p4/3K4/8/1p6/1P6/1Q6 w KQkq - 0 1"};function setSavedPosition(e){board.setPosition(savedPositions[e])}jQuery(function(n){var e=n("body"),i=n("#sidedrawer");n(".js-show-sidedrawer").on("click",function(){var e={onclose:function(){i.removeClass("active").appendTo(document.body)}},t=n(mui.overlay("on",e));i.appendTo(t),setTimeout(function(){i.addClass("active")},20)}),n(".js-hide-sidedrawer").on("click",function(){e.toggleClass("hide-sidedrawer")});var t=n("strong",i);t.next().hide(),t.on("click",function(){var e=n(this).next();e.is(":visible")?e.hide():e.show()})});
//# sourceMappingURL=app.js.map
